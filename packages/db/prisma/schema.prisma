generator client {
   provider = "prisma-client"
   output   = "../generated/prisma"
}

datasource db {
   provider = "postgresql"
}

model User {
   id          String        @id @default(uuid())
   email       String        @unique
   password    String
   role        Role
   createdAt   DateTime      @default(now())
   updatedAt   DateTime      @updatedAt
   leaderboars Leaderboard[]
   submissions Submission[]
}

enum Role {
   User
   Admin
}

model Contest {
   id                        String                      @id @default(uuid())
   title                     String
   startTime                 DateTime
   contestToChallengeMapping ContestToChallengeMapping[]
   leaderboards              Leaderboard[]
}

model ContestToChallengeMapping {
   id          String       @id @default(uuid())
   contestId   String
   challengeId String
   submissions Submission[]
   index       Int
   contest     Contest      @relation(fields: [contestId], references: [id], onDelete: Cascade)
   challenge   Challege     @relation(fields: [challengeId], references: [id], onDelete: Cascade)

   @@unique([contestId, challengeId])
}

model Challege {
   id                        String                      @id @default(uuid())
   title                     String
   notionDocId               String
   maxPoints                 Int
   contestToChallengeMapping ContestToChallengeMapping[]
}

model Submission {
   id                          String                    @id @default(uuid())
   submission                  String
   contestId                   String
   challengeId                 String
   points                      Int
   userId                      String
   user                        User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
   createdAt                   DateTime                  @default(now())
   contestToChallengeMappingId String
   contestToChallengeMapping   ContestToChallengeMapping @relation(fields: [contestToChallengeMappingId], references: [id], onDelete: Cascade)
}

model Leaderboard {
   id        String  @id @default(uuid())
   contestId String
   userId    String
   rank      Int
   user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
   contest   Contest @relation(fields: [contestId], references: [id], onDelete: Cascade)

   @@unique([contestId, userId])
}
